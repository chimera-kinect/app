let img;
let vid;
let maskImage;
let playing = true;

function vidLoad() {
  vid.loop();
  vid.volume(0);
  vid.hide();
  vid.play();
}

function preload() {
  img = loadImage('top-view-soil.jpg');
  vid = createVideo('forest.mp4', vidLoad);
  vid.size(3840, 2160);
}

let veins = [];
let isMousePressed = false;

function setup() {
  createCanvas(1280, 720);
  frameRate(60);
  maskImage = createGraphics(width, height);
  maskImage.noStroke();
  maskImage.fill(255);
}

function draw() {
  // Display image as the background
  image(img, 0, 0, width, height);

  // Display video on top of the image using a mask
  maskImage.clear();
  maskImage.ellipse(mouseX, mouseY, 90, 90); // Create a circular mask around the mouse position
  vid.mask(maskImage);
  image(vid, 0, 0, width, height);

  // Display veins
  for (let i = veins.length - 1; i >= 0; i--) {
    if (isMousePressed) {
      veins[i].update();
    } else {
      veins[i].reverse();
    }
    veins[i].display();

    if (veins[i].isFinished()) {
      veins.splice(i, 1);
    }
  }
}

function mousePressed() {
  isMousePressed = true;

  // Create veins
  let numVeins = floor(random(3, 6));
  for (let i = 0; i < numVeins; i++) {
    let vein = new Vein(mouseX, mouseY, 0);
    veins.push(vein);
  }
}

function mouseReleased() {
  isMousePressed = false;
}

class Vein {
  // ... (rest of the Vein class remains unchanged)
}

// Define preload, setup, draw, mousePressed, and mouseReleased as window global functions
window.preload = preload;
window.setup = setup;
window.draw = draw;
window.mousePressed = mousePressed;
window.mouseReleased = mouseReleased;